pico-8 cartridge // http://www.pico-8.com
version 15
__lua__
-- seq 16
-- pentatonic sequencer

function note(st,inst,vol,fx)
 return
  { st + 64*(inst%4)
  , 16*fx + 2*vol + inst/4
  }
end

function sfx_addr(sf)
	return 0x3200 + 68 * sf
end

function set_note(sf,t,note)
 local i = sfx_addr(sf)
 poke(i + 2*t, note[1])
 poke(i + 2*t + 1, note[2])
end

function set_speed(sf,speed)
	local i = sfx_addr(sf)
 poke(i + 65, speed)
end

function set_loop(sf,debut,fin)
  local i = sfx_addr(sf)
  poke(i + 66, debut)
  poke(i + 67, fin)
end

function _init()
	matrix = {}
	for i = 1, 16 do
		matrix[i] = {}
		for j = 1, 16 do
			matrix[i][j] = false
		end
	end

	set_loop(0,0,16)
	set_speed(0,24)
	sfx(0)
end

local penta =
	{56,53,51,49,46,44,41,39
	,37,34,32,29,27,25,22,20
	}

function toggle(i, j)
	local new = not matrix[i][j]
	matrix[i][j] = new

	for j=0,16 do
		mset(i-1,j,001)
	end

	if new then
		local la=note(penta[j],0,7,5)
		set_note(0,i-1,la)
		mset(i-1,j-1,002)
	else
		set_note(0,i-1,{0,0})
	end
end

hand = { x = 64, y = 64 }

hand.update = function (a)
	local dx,dy = 0,0
	if (btn"0") dx -= 2
	if (btn"1") dx += 2
	if (btn"2") dy -= 2
	if (btn"3") dy += 2
	hand.x = (hand.x + dx) % 128
	hand.y = (hand.y + dy) % 128

	if btnp"4" then
		local i = hand.x / 8 + 1
		local j = hand.y / 8 + 1
		toggle(flr(i), flr(j))
	end
end

function _update()
	hand:update()
end

function _draw()
	cls(1)
	local x = stat(20) * 8
	rectfill(x,0,x+7,128,0)
	map(0,0,0,0,16,16)
	spr(003,hand.x,hand.y)
end
__gfx__
00000000000000000000000011111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000017771000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000777777017711000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000777777017171000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000777777011111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
17777771111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
17777771111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
17777771111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
17777771111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111117777771111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111117777771111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111117777771111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111117777771111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111777777111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111777777111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111777777111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111777777111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111077777701111111111111111177777711111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111077777701111111111111111177777711111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111077777701111111111111111177777711111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111077777701111111111111111177777711111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111117777771000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111117777771000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111117777771000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111117777771000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111777777111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111777777111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111777777111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111777777111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111777777111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111777777111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111777777111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111777777111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111777111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111771111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111717111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111

__map__
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
