pico-8 cartridge // http://www.pico-8.com
version 15
__lua__
-- providence
-- work in progress

function wav(val,amp,len)
	return amp*sin(val/len)
end


function new_backdrop()
	local backdrop = {v=0}

	function backdrop:update()
		local speed = wav(gt,0.7,98)
		self.v += speed
	end

	function backdrop:draw()
		cls()
		map(16,0,0,0,16,16)
		map(32,0,0,-64+self.v,16,32)
		map(0,16,64+self.v,72,16,2)
		map(0,16,-64-self.v,72,16,2)
		map(0,0,0,0,16,16)
	end

 return backdrop
end


function new_eye()
	local eye =
	{ x = 48, y = 0, by = 0
	, px = 0, py = 0
	}

	function eye:update()
		self.y = 1+wav(gt,1.98,98)
		self.by = -2+wav(gt+40,2.98,98)

		local d = atan2(pl.x-64,pl.y-20)
		self.px = flr(2*cos(d)+0.5)
		self.py = flr(2*sin(d)+0.5)
	end

	function eye:draw()
		spr(010,self.x-8,self.by,6,4)
		spr(078,
				self.x+self.px+8,
				self.y+self.py+16,2,2)
		spr(006,self.x,self.y,4,4)
	end

	return eye
end


function new_player()
	local pl =
	{ x = 64, y = 112
	, speed = 2
	, tail = {}
	}
	
	for i=1,4 do
		pl.tail[i] =
		{ x = pl.x, y = pl.y
		, frame = 072 + i
		}
	end

	function pl:joydelta()
		local dx,dy = 0,0
		if (btn"0") dx -= self.speed
		if (btn"1") dx += self.speed
		if (btn"2") dy -= self.speed
		if (btn"3") dy += self.speed
		return dx,dy
	end

	function pl:update()
		local cx,cy = self.x,self.y
		for a in all(self.tail) do
			local tx,ty = a.x,a.y
			a.x,a.y = cx,cy
			cx,cy = tx,ty
		end
	
		local dx,dy = self:joydelta()
		self.x += dx
		self.y += dy
		self.x = min(max(self.x,0),121)
		self.y = min(max(self.y,0),121)
	end

	function pl:draw()
		for a in all(pl.tail) do
			spr(a.frame,a.x,a.y)
		end
		spr(072,self.x,self.y)
	end

	return pl
end


function transparent(col)
	palt(0,false)
	palt(col,true)
end

function _init()
	gt = 0
	transparent(15)

	backdrop = new_backdrop()
	eye = new_eye()
	pl = new_player()
end

function _update()
	gt += 1
	backdrop:update()
	eye:update()
	pl:update()
end

function _draw()
	backdrop:draw()
	eye:draw()
	pl:draw()
end
__gfx__
000000001111111111111111ffffffff0ffffffffffffffffffffffffffffffffffffffffffffffff1155555555551133333333333333333333333311115511f
000000001333333333333333ffffffff0ffffffffffffffffffffffffffffff00fffffffffffffffff1115555555551133333333333333333333311115555511
007007001333333333333333fffffff030ffffffffffffffffffffffffffff0330fffffffffffffffff111155555555113333333333333333311111555555551
000770001333333333333333fffffff030fffffffffffffffffffffffffff03bb30fffffffffffffffff11111555555511333333333333333111155555555111
000770001333333333333333ffffff03330ffffffffffffffffffffffffff03bb30fffffffffffff11f11331111555555111333333333331111555555551111f
007007001333333333333333ffffff03330fffffffffffffffffffffffff03bbbb30ffffffffffff151133333111115555511333333331111555555551111fff
000000001333333333333333fffff0333330ffffffffffffffffffffffff03bbbb30ffffffffffff1511333333311115555511133311111555555551113111ff
000000001555555555555555fffff0555550fffffffffffffffffffffff03bbbbbb30fffffffffff15511333333311111555511111115555555551113333151f
ffffffffffffffffffffffffffff011111110fff15151515fffffffffff03bbbbbb30fffffffffff155111133333333111155551115555555551111333331551
ffffffffffffffffffffffffffff033333330fff51515151ffffffffff03bbbbbbbb30ffffffffff115551111333333331115555555555555111113333331151
fffffffffffffffffffffffffff03333333330ff15151515ffffffffff03bbbbbbbb30fffffffffff15555511113333333311555555555511113333333311551
fffffffffffffffffffffffffff03333333330ff51515151fffffffff03bbbbbbbbbb30ffffffffff11555555111133333331155555511111333333331115551
ffffffffffffffffffffffffff0333333333330f15151515fffffffff03bbbbbbbbbb30fffffffffff1555555551111333333111555111133333333111155551
ffffffffffffffffffffffffff0333333333330f51515151ffffffff03bbbbbbbbbbbb30ffffffffff1115555555511113333311111113333333311115555511
fffffffffffffffffffffffff03333333333333015151515ffffffff03bbbbbbbbbbbb30fffffffffff111155555551111133331111333333331111555555511
fffffffffffffffffffffffff05555555555555051515151fffffff03bbbbbbbbbbbbbb30fffffffffff11111555555511111331133333333111115555555111
ffffffffffffffffffffffff011111110111111100000000fffffff03bbbbbbbbbbbbbb30ffffffff11f1131111555555551111113333331111555555551111f
ffffffffffffffffffffffff033333330333333300000000ffffff03bbbbb111111bbbbb30ffffff15111333311111555555511113333111155555555111ffff
fffffffffffffffffffffff0333333333333333310001000ffffff03bbb1111111111bbb30ffffff1511333333311115555555511331111555555551111fffff
fffffffffffffffffffffff0333333333333333301010101fffff03bb1111ffffff1111bb30fffff1551133333333111155555511111155555551111111fffff
ffffffffffffffffffffff03333333333333333310101010fffff03b111ffffffffff111b30fffff15511113333333111115555111155555555111133311ffff
f000000000000000ffffff03333333333333333331013101ffff03b1177ffffffffff7711b30ffff11555111133333333111115115555555511113333331ffff
fb3b3b3b3b3b3b3bffffff03333333333333333313131313ffff03b1777ffffffffff7771b30fffff15555511111333333111111155555511113333333311111
f000000000000000ffffff33555555553333333301310131fff03bbb177ffffffffff771bbb30ffff11555555111133333333111155111111333333333333331
1b111b111fffffff0fffffff111111111111111113131313fff03bbbb11ffffffffff11bbbb30fffff1555555551111333331111111111133333333133333331
111311131fffffff0fffffff133333333333333331013101ff03bbbbbbb11ffffff11bbbbbbb30ffff1115555555511111311ffffff11333333331111333311f
131113111fffffff30ffffff133333333333333313131313ff03bbbbbbbbb111111bbbbbbbbb30fffff11115555555511111ffffffff1133333111fff1111fff
111b111b1fffffff30ffffff133333333333333331313131f03bbbbbbbbbbbbbbbbbbbbbbbbbb30ffffff1111555555551ffffffffffff11311fffffffffffff
1b111b111fffffff330fffff133333333333333313131313f03bbbbbbbbbbbbbbbbbbbbbbbbbb30fffffffff111555551ffffffffffffff1111fffffffffffff
111311131fffffff330fffff13333333333333333131313103bbbbbbbbbbbbbbbbbbbbbbbbbbbb30ffffffffff111111ffffffffffffffffffffffffffffffff
131113111fffffff330fffff13333333333333331313131303333333333333333333333333333330ffffffffffffffffffffffffffffffffffffffffffffffff
111b111b1fffffff333fffff33333333333333331111111100000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffff
0000033333000000000000000000000000000000000000000000000000000000ff999fffff999fffffffffffffffffffffffffff00000000fff7777777777fff
0003333333330000000000000000003000000000000000000000000000000000f9aaa9fff99999ffff999fffffffffffffffffff00000000f77777777777777f
00333333333330000000000500000000000050000000000000000000000050009aaaaa9f9999999ff99999ffff999fffffffffff00000000f77777777777777f
03333333333333000010000000000000000000000000000000030000000000009aaaaa9f9999999ff99999ffff999ffffff9ffff000000007777773333777777
03333333333333000000000000000000000000000000000000000000000000009aaaaa9f9999999ff99999ffff999fffffffffff000000007777733003377777
3333333333333330000000000005000000300001000000000000000001000000f9aaa9fff99999ffff999fffffffffffffffffff000000007777730700377777
3333333333333330000000000000000000000000000005000000000000000000ff999fffff999fffffffffffffffffffffffffff000000007777730000377777
3333333333333330050000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffff000000007777733003377777
33333333333333300000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000007777773333777777
3333333333333330000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f77777777777777f
0333333333333300000000000000000000000000050000000000000000050000000000000000000000000000000000000000000000000000f77777777777777f
0333333333333300000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000fff7777777777fff
0033333333333000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000ffffffffffffffff
0003333333330000003000000000000000300000000010000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffff
0000033333000000000000000010000000000000000000000000001000000000000000000000000000000000000000000000000000000000ffffffffffffffff
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffff
__map__
0000000000000000000000000000000000004600000000000000000053000045000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000043004343000000000000004500404100000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000055465253000000000000000000505100000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000043440000540000000000000053450057000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000465355000000000000004544574344000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000202121212121000000000042000044000000000000004600465354000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000003230102010201040000000052544557000000000000000043000045000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000013010201020102140000000057000000000000000000000000570000000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000323020102010201020400000000000000000000000000000000000000000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000001302010201020102011400000000000000000000000000000000000000000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000032301020102010201020104000000000000000000000000000000000000000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000130102010201020102010214000015151515151515151515151515151515000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0003230201020102010201020102040015151515151515151515151515151515000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0013020102010201020102010201140015151515151515151515151515151515000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2224333433343334333433343334333215151515151515151515151515151515000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1515151515151515151515151515151515151515151515151515151515151515000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2525252525252525252525252525252525252525250000000000000000000000000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3535353535353535353535353535353535353535350000000000000000000000000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000030303030303031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
