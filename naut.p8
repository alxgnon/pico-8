pico-8 cartridge // http://www.pico-8.com
version 15
__lua__
function spawn(a)
	add(actors, a)
end

function control_drive(a)
	a.dx, a.dy = 0, 0
	if (btn"0") a.dx -= a.speed
	if (btn"1") a.dx += a.speed
	if (btn"2") a.dy -= a.speed
	if (btn"3") a.dy += a.speed
end

function control_shoot(a)
	if a.power > 0 then
		if btn"4"
		and a.press != 5 then
			sfx"01"
			a.press = 4
			a.power -= 4
			spawn(charm(a.x+2,a.y+12,-1.5))
			spawn(charm(a.x+16,a.y+12,1.5))

		elseif btn"5"
		and a.press != 4 then
			sfx"02"
			a.press = 5
			a.power -= 4
			spawn(spell(a.x+3,a.y+10))
			spawn(spell(a.x+16,a.y+10))

		else
			a.press = nil
		end
	end
end

function softwall(a,x1,y1,x2,y2)
	a.x = min(max(a.x, x1), x2)
	a.y = min(max(a.y, y1), y2)
end

function refill_power(a)
	a.power += a.refill
	a.power=min(a.power,a.maxpower)
end

function player(x, y)
	return
	{ f = 001
	, x = x, y = y
	, dx = 0, dy = 0
	, w = 3, h = 4
	, speed = 5
	, power = 8
	, maxpower = 8
	, refill = 4
	}
end

function charm(x, y, dx)
	return
	{ f = 004 + rnd"4"
	, x = x, y = y
	, dx = dx, dy = -7
	, w = 1, h = 1
	}
end

function spell(x, y)
	return
	{ f = 020 + rnd"4"
	, x = x, y = y
	, dx = 0, dy = -9
	, w = 1, h = 1
	}
end

function _init()
	gt = 0

	pl = player(56, 84)

	actors = {}
	add(actors, pl)
end

function _update()
	gt += 1

	control_drive(pl)

	for a in all(actors) do
		if a.x < -88
		or a.x > 188
		or a.y < -88
		or a.y > 188 then
			del(actors, a)
		end

		a.x += a.dx
		a.y += a.dy
	end

	softwall(pl,-10,-24,115,101)
	control_shoot(pl)
	refill_power(pl)
end

function _draw()
	cls()
	for a in all(actors) do
		spr(a.f, a.x, a.y, a.w, a.h)
	end
end
__gfx__
00000000000000000dd0000000000000033300000333000003330000033300000000000000000000000000000000000000000000000000000000000000000000
00000000000000000ddd0000000000003bbb300033b3300033b330003bbb30000000000000000000000000000000000000000000000000000000000000000000
00700700000000000dddd000000000003b3b300033b330003bbb300033b330000000000000000000000000000000000000000000000000000000000000000000
00077000000000006d1ddd00000000003b3b30003bbb300033b3300033b330000000000000000000000000000000000000000000000000000000000000000000
00077000000000000ddd1d6000000000033300000333000003330000033300000000000000000000000000000000000000000000000000000000000000000000
00700700000000006d1ddd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000ddd1d6000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000ddddd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000ddd00000000000033000000330000003300000033000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000666000000000003b3300003bb300003bb3000033b300000000000000000000000000000000000000000000000000000000000000000000
000000000000000000111000000000003bb300003b33000033b300003bb300000000000000000000000000000000000000000000000000000000000000000000
0000000000000000006660000000000033b3000033b300003bb3000033b300000000000000000000000000000000000000000000000000000000000000000000
000000000000000000111000000000003bb300003b33000033b300003bb300000000000000000000000000000000000000000000000000000000000000000000
000000000000000000666000000000003b3300003bb3000033b300003b3300000000000000000000000000000000000000000000000000000000000000000000
00000000000000000011100000000000033000000330000003300000033000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000066600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000011100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000066600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000011100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000066660066600666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000066161d01110d161660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000616161ddddddd161616000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000006616161ddddddd161616600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000061616161d11111d161616160000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000061616161d1bbb1d161616160000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000061616000d1b1b1d000616160000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000006160000dd1bbb1dd00006160000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000600000ddd11111ddd0000060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000ddddddddddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000d000ddddd000d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000ddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01010000210202d010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010100002302019010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01020000290302d010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__music__
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000

