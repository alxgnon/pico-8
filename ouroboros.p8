pico-8 cartridge // http://www.pico-8.com
version 15
__lua__
-- ouroboros
-- work in progress

rose = 003
vert = 007

curr = nil

function bright(frame)
	if (frame==rose) return 14
	if (frame==vert) return 11
	return 1
end

function muted(frame)
	if (frame==rose) return 02
	if (frame==vert) return 03
	return 1
end

function snake(frame,x,y,dx)
	local a =
	{ x = x, y = y
	,	dx = dx, dy = 0
	, tail = {}
	, frame = frame
	, move = move_snake
	, control = control_snake
	, draw = draw_snake
	, ruler = draw_ruler
	}

	for i=2,1,-1 do
		add(a.tail,
		{x = x-sgn(dx)*i, y = y})
	end

	return a
end

function move_snake(a)
	add(a.tail,{x=a.x,y=a.y})
	del(a.tail,a.tail[1])
	a.x = (a.x+a.dx)%14
	a.y = (a.y+a.dy)%14
end

function control_snake(a)
	if a.dx == 0 then
		if (btn"0") a.dx,a.dy=-1,0
		if (btn"1")	a.dx,a.dy=1,0
	else
		if (btn"2") a.dx,a.dy=0,-1
		if (btn"3") a.dx,a.dy=0,1
	end
end

function draw_snake(a)
	local frame = a.frame
	if curr ~= frame then
		frame += 2
	end

	for b in all(a.tail) do
		spr(frame+1,
		flr(b.x+1)*8,flr(b.y+1)*8)
	end

	spr(frame,
	flr(a.x+1)*8,flr(a.y+1)*8)
end

function draw_ruler(a)
	local color = muted(a.frame)
	local x,y=flr(a.x+1)*8,flr(a.y+1)*8
	rectfill(x+1,8,x+5,118,color)
	rectfill(8,y+1,118,y+5,color)
end

function _init()
	pal(4, 0)
	rosee = snake(rose,5,8,-1)
	verte = snake(vert,8,5,1)
end

function switch()
	if btn"4" then
		curr = rose
	elseif btn"5" then
		curr = vert
	end
end

t = 0
function _update()
	switch()
	if (not curr) return

	t += 1

	if (curr==rose) rosee:control()
	if (curr==vert) verte:control()

	if t % 5 == 0 then
 	rosee:move()
 	verte:move()
 end
end

function draw_border()
	local color = bright(curr)
	rect(0,2,126,124,color)
	rect(2,0,124,126,color)
end

function _draw()
	cls()
	draw_border()
	if (curr==rose) rosee:ruler()
	if (curr==vert) verte:ruler()
	map(0,0,0,0,128,128)
	rosee:draw()
	verte:draw()
end
__gfx__
000000001111111411111114eeeeeee0eeeeeee02222222022222220bbbbbbb0bbbbbbb033333330333333300000000000000000000000000000000000000000
000000001000001410000014e22222e0e22222e02eeeee202eeeee20b33333b0b33333b03bbbbb303bbbbb300000000000000000000000000000000000000000
007007001011101410111014e27772e0e22222e02eeeee202e222e20b37773b0b33333b03bbbbb303b333b300000000000000000000000000000000000000000
000770001010101410111014e27172e0e22222e02eeeee202e222e20b37173b0b33333b03bbbbb303b333b300000000000000000000000000000000000000000
000770001011101410111014e27772e0e22222e02eeeee202e222e20b37773b0b33333b03bbbbb303b333b300000000000000000000000000000000000000000
007007001000001410000014e22222e0e22222e02eeeee202eeeee20b33333b0b33333b03bbbbb303bbbbb300000000000000000000000000000000000000000
000000001111111411111114eeeeeee0eeeeeee02222222022222220bbbbbbb0bbbbbbb033333330333333300000000000000000000000000000000000000000
00000000444444444444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
00111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000
00100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000101010101011101010101010101110101010101010111010101010101011101010101010101110101010101010111010101010101011101000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000101110101010101010111010101010101011101010101010101110101010101010111010101010101011101010101010101110101010101000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000101010101011101010101010101110101010101010111010101010101011101010101010101110101010101010111010101010101011101000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000101110101010101010111010101010101011101010101010101110101010101010111010101010101011101010101010101110101010101000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000101010101011101010101010101110101010101010111010101010101011101010101010101110101010101010111010101010101011101000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000111111101111111011111110111111101111111011111110333333303333333033333330111111101111111011111110111111101111111000001010
101000001000001010000010100000101000001010000010100000103bbbbb303bbbbb303bbbbb30100000101000001010000010100000101000001000001010
101000001011101010111010101110101011101010111010101110103b333b303b333b303bbbbb30101110101011101010111010101110101011101000001010
101000001011101010101010101110101010101010111010101010103b333b303b333b303bbbbb30101010101011101010101010101110101010101000001010
101000001011101010111010101110101011101010111010101110103b333b303b333b303bbbbb30101110101011101010111010101110101011101000001010
101000001000001010000010100000101000001010000010100000103bbbbb303bbbbb303bbbbb30100000101000001010000010100000101000001000001010
10100000111111101111111011111110111111101111111011111110333333303333333033333330111111101111111011111110111111101111111000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000101010101011101010101010101110101010101010111010101010101011101010101010101110101010101010111010101010101011101000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000101110101010101010111010101010101011101010101010101110101010101010111010101010101011101010101010101110101010101000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000111111101111111011111110111111101111111022222220222222202222222011111110111111101111111011111110111111101111111000001010
1010000010000010100000101000001010000010100000102eeeee202eeeee202eeeee2010000010100000101000001010000010100000101000001000001010
1010000010111010101110101011101010111010101110102eeeee202e222e202e222e2010111010101110101011101010111010101110101011101000001010
1010000010101010101110101010101010111010101010102eeeee202e222e202e222e2010101010101110101010101010111010101010101011101000001010
1010000010111010101110101011101010111010101110102eeeee202e222e202e222e2010111010101110101011101010111010101110101011101000001010
1010000010000010100000101000001010000010100000102eeeee202eeeee202eeeee2010000010100000101000001010000010100000101000001000001010
10100000111111101111111011111110111111101111111022222220222222202222222011111110111111101111111011111110111111101111111000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000101110101010101010111010101010101011101010101010101110101010101010111010101010101011101010101010101110101010101000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000101010101011101010101010101110101010101010111010101010101011101010101010101110101010101010111010101010101011101000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000101110101010101010111010101010101011101010101010101110101010101010111010101010101011101010101010101110101010101000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000101010101011101010101010101110101010101010111010101010101011101010101010101110101010101010111010101010101011101000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000101110101010101010111010101010101011101010101010101110101010101010111010101010101011101010101010101110101010101000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
00100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000
00111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001020102010201020102010201020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0002010201020102010201020102010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001020102010201020102010201020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0002010201020102010201020102010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001020102010201020102010201020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0002010201020102010201020102010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001020102010201020102010201020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0002010201020102010201020102010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001020102010201020102010201020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0002010201020102010201020102010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001020102010201020102010201020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0002010201020102010201020102010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001020102010201020102010201020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0002010201020102010201020102010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
