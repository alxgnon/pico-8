pico-8 cartridge // http://www.pico-8.com
version 15
__lua__
-- ouroboros
-- work in progress

rose = 003
vert = 009

curr = nil

function bright(snake)
	if (snake==rosee) return 14
	if (snake==verte) return 11
	return 1
end

function muted(snake)
	if (snake==rosee) return 02
	if (snake==verte) return 03
	return 1
end

function other(snake)
	if (snake==verte) return rosee
	if (snake==rosee) return verte
end

function snake(frame,x,y,dx)
	local a =
	{ x = x, y = y
	,	dx = dx, dy = 0
	, ddx = dx, ddy = 0
	, tail = {}
	, frame = frame
	, move = move_snake
	, control = control_snake
	, draw = draw_snake
	, ruler = draw_ruler
	}

	for i=6,1,-1 do
		add(a.tail,
		{x = x-sgn(dx)*i, y = y})
	end

	return a
end

function move_snake(a)
	a.dx,a.dy=a.ddx,a.ddy
	add(a.tail,{x=a.x,y=a.y})
	del(a.tail,a.tail[1])
	a.x = (a.x+a.dx)%14
	a.y = (a.y+a.dy)%14
end

function control_snake(a)
	if a.dx == 0 then
		if (btn"0") a.ddx,a.ddy=-1,0
		if (btn"1")	a.ddx,a.ddy=1,0
	else
		if (btn"2") a.ddx,a.ddy=0,-1
		if (btn"3") a.ddx,a.ddy=0,1
	end
end

function collides(a, b)
	return
	flr(a.x)==flr(b.x) and
	flr(a.y)==flr(b.y)
end

function draw_snake(a)
	local other = other(a)

	local frame = a.frame
	if curr ~= a then
		frame += 2
	end

	for b in all(a.tail) do
		if collides(b, other) then
			spr(a.frame+5,
			flr(b.x+1)*8,flr(b.y+1)*8)
			goto next
		end

		for c in all(other.tail) do
			if collides(b, c) then
				spr(a.frame+5,
				flr(b.x+1)*8,flr(b.y+1)*8)
				goto next
			end
		end

		spr(frame+1,
		flr(b.x+1)*8,flr(b.y+1)*8)
		::next::
	end

	if collides(a, other) then
		spr(a.frame+4,
		flr(a.x+1)*8,flr(a.y+1)*8)
		return
	end

	for c in all(other.tail) do
		if collides(a, c) then
			spr(a.frame+4,
			flr(a.x+1)*8,flr(a.y+1)*8)
			return
		end
	end

	spr(frame,
	flr(a.x+1)*8,flr(a.y+1)*8)
end

function draw_ruler(a)
	local color = muted(a)
	local x,y=flr(a.x+1)*8,flr(a.y+1)*8
	if a.dx == 0 then
		rectfill(x+1,8,x+5,118,color)
	else
		rectfill(8,y+1,118,y+5,color)
	end
end

function _init()
	pal(4, 0)
	rosee = snake(rose,5,8,-1)
	verte = snake(vert,8,5,1)
end

function switch()
	if btn"4" then
		curr = rosee
	elseif btn"5" then
		curr = verte
	end
end

t = 0
function _update()
	switch()
	if (not curr) return

	t += 1
	curr:control()
	if t % 5 == 0 then
		rosee:move()
		verte:move()
	end
end

function draw_border()
	local color = bright(curr)
	rect(0,2,126,124,color)
	rect(2,0,124,126,color)
end

function _draw()
	cls()
	draw_border()
	if other(curr) then
		other(curr):ruler()
	end
	map(0,0,0,0,128,128)
	rosee:draw()
	verte:draw()
end
__gfx__
000000001111111411111114eeeeeee0eeeeeee022222220222222200001eee00001eee0bbbbbbb0bbbbbbb03333333033333330bbb10000bbb1000000000000
000000001000001410000014e22222e0e22222e02eeeee202eeeee200001e2e0000122e0b33333b0b33333b03bbbbb303bbbbb30b3b10000b331000000000000
007007001011101410111014e27772e0e22222e02eeeee202e222e200001eee0000122e0b37773b0b33333b03bbbbb303b333b30bbb10000b331000000000000
000770001010101410111014e27172e0e22222e02eeeee202e222e201111111011111110b37173b0b33333b03bbbbb303b333b30111111101111111000000000
000770001011101410111014e27772e0e22222e02eeeee202e222e20eee10000e2210000b37773b0b33333b03bbbbb303b333b300001bbb0000133b000000000
007007001000001410000014e22222e0e22222e02eeeee202eeeee20e2e10000e2210000b33333b0b33333b03bbbbb303bbbbb300001b3b0000133b000000000
000000001111111411111114eeeeeee0eeeeeee02222222022222220eee10000eee10000bbbbbbb0bbbbbbb033333330333333300001bbb00001bbb000000000
00000000444444444444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
00111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000
00100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000101010101011101010101010101110101010101010111010101010101011101010101010101110101010101010111010101010101011101000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000101110101010101010111010101010101011101010101010101110101010101010111010101010101011101010101010101110101010101000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000101010101011101010101010101110101010101010111010101010101011101010101010101110101010101010111010101010101011101000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000101110101010101010111010101010101011101010101010101110101010101010111010101010101011101010101010101110101010101000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000101010101011101010101010101110101010101010111010101010101011101010101010101110101010101010111010101010101011101000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000111111101111111011111110111111101111111011111110333333303333333033333330111111101111111011111110111111101111111000001010
101000001000001010000010100000101000001010000010100000103bbbbb303bbbbb303bbbbb30100000101000001010000010100000101000001000001010
101000001011101010111010101110101011101010111010101110103b333b303b333b303bbbbb30101110101011101010111010101110101011101000001010
101000001011101010101010101110101010101010111010101010103b333b303b333b303bbbbb30101010101011101010101010101110101010101000001010
101000001011101010111010101110101011101010111010101110103b333b303b333b303bbbbb30101110101011101010111010101110101011101000001010
101000001000001010000010100000101000001010000010100000103bbbbb303bbbbb303bbbbb30100000101000001010000010100000101000001000001010
10100000111111101111111011111110111111101111111011111110333333303333333033333330111111101111111011111110111111101111111000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000101010101011101010101010101110101010101010111010101010101011101010101010101110101010101010111010101010101011101000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000101110101010101010111010101010101011101010101010101110101010101010111010101010101011101010101010101110101010101000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000111111101111111011111110111111101111111022222220222222202222222011111110111111101111111011111110111111101111111000001010
1010000010000010100000101000001010000010100000102eeeee202eeeee202eeeee2010000010100000101000001010000010100000101000001000001010
1010000010111010101110101011101010111010101110102eeeee202e222e202e222e2010111010101110101011101010111010101110101011101000001010
1010000010101010101110101010101010111010101010102eeeee202e222e202e222e2010101010101110101010101010111010101010101011101000001010
1010000010111010101110101011101010111010101110102eeeee202e222e202e222e2010111010101110101011101010111010101110101011101000001010
1010000010000010100000101000001010000010100000102eeeee202eeeee202eeeee2010000010100000101000001010000010100000101000001000001010
10100000111111101111111011111110111111101111111022222220222222202222222011111110111111101111111011111110111111101111111000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000101110101010101010111010101010101011101010101010101110101010101010111010101010101011101010101010101110101010101000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000101010101011101010101010101110101010101010111010101010101011101010101010101110101010101010111010101010101011101000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000101110101010101010111010101010101011101010101010101110101010101010111010101010101011101010101010101110101010101000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000101010101011101010101010101110101010101010111010101010101011101010101010101110101010101010111010101010101011101000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000101110101010101010111010101010101011101010101010101110101010101010111010101010101011101010101010101110101010101000001010
10100000101110101011101010111010101110101011101010111010101110101011101010111010101110101011101010111010101110101011101000001010
10100000100000101000001010000010100000101000001010000010100000101000001010000010100000101000001010000010100000101000001000001010
10100000111111101111111011111110111111101111111011111110111111101111111011111110111111101111111011111110111111101111111000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
00100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000
00111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001020102010201020102010201020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0002010201020102010201020102010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001020102010201020102010201020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0002010201020102010201020102010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001020102010201020102010201020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0002010201020102010201020102010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001020102010201020102010201020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0002010201020102010201020102010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001020102010201020102010201020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0002010201020102010201020102010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001020102010201020102010201020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0002010201020102010201020102010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001020102010201020102010201020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0002010201020102010201020102010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
