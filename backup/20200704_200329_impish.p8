pico-8 cartridge // http://www.pico-8.com
version 27
__lua__
-- impish
--

-- resets the cartridge.
function _init()
	tick=0
	ready=55
	wait={[4]=0,[5]=0}
	rel={[4]=false,[5]=false}
	shot={}
	baddie={}
	px,py=56,24
	palt(0,false)
	palt(1,true)
end

-- runs the game loop.
function _update()
	if(ready>0)ready-=1
	tick+=1
	spawn()
	move_shot()
	move_baddie()
	input()
	move_player()
	shooting(4,-8)
	shooting(5,16)
end

-- moves the shots on screen.
function move_shot()
	for e in all(shot) do
		e.y+=12
		if e.y>138 then
			del(shot,e)
		end
	end
end

-- moves all active baddies.
function move_baddie()
	for e in all(baddie) do
		e.t+=1
		e.x+=e.dx
		e.y+=e.dy
		if e.sz==1 then
		elseif e.sz==2 then
			e.f=e.id+flr(e.t/20%2)*2
		end
	end
end

-- receives input from player.
function input()
	p_dx,p_dy=0,0
	if(btn"0")p_dx-=5
	if(btn"1")p_dx+=5
	if(btn"2")p_dy-=5
	if(btn"3")p_dy+=5
end

-- moves the player character.
function move_player()
	if p_dx*p_dy!=0 then
		p_dx*=0.707
		p_dy*=0.707
	end
	px=min(max(px+p_dx,-4),117)
	py=min(max(py+p_dy,-4),117)
end

-- controls shooting.
function shooting(n,ox)
	if(wait[n]>0)wait[n]-=1
	if btn(n) then
		if wait[n]==0 and rel[n] then
			add(shot,{x=px+ox,y=py-4})
			wait[n]=88
		end
	end
	rel[n]=not btn(n)
end

-- draws the screen.
function _draw()
	cls()
	map(0,0,-8,-(tick%32),6,20)
	map(6,0,40,-(tick%32),6,20)
	map(12,0,88,-(tick%32),6,20)
	draw_player()
	draw_arm(4,-8)
	draw_arm(5,16)
	for e in all(shot) do
		spr(1,e.x,e.y,1,4)
	end
	draw_baddie()
end

-- draws the player character.
function draw_player()
	if wait[4]*wait[5]==0 then
		spr(2,px,py,2,2)
	else
		spr(34,px,py,2,2)
	end
end

-- draws the player's arm.
function draw_arm(n,ox)
	if wait[n]==0 then
		spr(4,px+ox,py-4,1,4)
	else
		ox+=sgn(ox)*16*wait[n]
		spr(5,px+ox,py-4,1,4)
	end
end

-- draws all active baddies.
function draw_baddie()
	for e in all(baddie) do
			spr(e.f,e.x,e.y,e.sz,e.sz)
	end
end

-->8
-- baddie ids
tox=42
slime=168
baby=26

-- spawns enemies to fight.
function spawn()
	if #baddie==0 and ready==0 then
		local x=32+rnd(48)
		add(baddie,{
			id=tox,
			t=0,
			x=x,
			y=128,
			dx=(64-x)/128,
			dy=-0.25,
			sz=2
		})
	end
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000222222222222222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700004020202020202020200400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000020020202020202020200020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000020000000000000000002220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700022200000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000020000000000000000002220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000022200000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000020000000000000000002220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000022200000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000020000000000000000002220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000022200000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000020002020202020202020020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000004002020202020202020400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000222222222222222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000222222220000000002000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000200000020000000000200200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000222222220200000000022000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000020000200000000000200200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000002002000000000002000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000220000000000022222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000002002000000040020000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000020000200000000022222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000011111aaaaa11111111111aaaaa11111111aaa11111777111119991111188811100000000000000000000000000000000
00000000000000000000000000000000111aaa888aaa1111111aaaeeeaaa111111aaa11111777111119991111188811100000000000000000000000000000000
0000000000000000000000000000000011aaa87888aaa11111aaae7eeeaaa1111199911111ccc111114441111122211100000000000000000000000000000000
000000000000000000000000000000001aaaa88888aaaa111aaaaeeeeeaaaa111199911111ccc111114441111122211100000000000000000000000000000000
000000000000000000000000000000001aaaaa888aaaaa111aaaaaeeeaaaaa111199911111ccc111114441111122211100000000000000000000000000000000
00000000000000000000000000000000aa000aaaaa000aa1aa000aaaaa000aa11199911111ccc111114441111122211100000000000000000000000000000000
00000000000000000000000000000000aa0c00aaa00c0aa1aa0000aaa0000aa1aaaaaaa177777771999999918888888100000000000000000000000000000000
00000000000000000000000000000000aa0cc00000cc0aa1aa0d0000000d0aa1aaaaaaa177777771999999918888888100000000000000000000000000000000
00000000000000000000000000000000aa0ccc000ccc0aa1aa0dd00000dd0aa11766661117777711199999111888881100000000000000000000000000000000
00000000000000000000000000000000aa00cc000cc00aa1aa00dd000dd00aa11766661117777711199999111888881100000000000000000000000000000000
00000000000000000000000000000000aaa000000000aaa1aaa000000000aaa11766661117777711199999111888881100000000000000000000000000000000
000000000000000000000000000000001aaa0000000aaa111aaa0000000aaa111760761117707711199099111880881100000000000000000000000000000000
000000000000000000000000000000001aaaa00000aaaa111aaaa00000aaaa111760761117707711199099111880881100000000000000000000000000000000
0000000000000000000000000000000011aaaa000aaaa11111aaaa000aaaa1111760761117707711199099111880111100000000000000000000000000000000
00000000000000000000000000000000111aaa000aaa1111111aaa000aaa11111760761117707711199099111811111100000000000000000000000000000000
00000000000000000000000000000000111111111111111111111111111111111760761117707711199099111111111100000000000000000000000000000000
11111666661111111111166666611111111666000666111111116666661111111760761117707711199099111111111100000000000000000000000000000000
11166655566611111116666666666111116666000666611111666666666611111760761117707711199099111111181100000000000000000000000000000000
11666575556661111166600000666611166660000066661116666000006661111760761117707711199099111180881100000000000000000000000000000000
16666555556666111666600000066661166600000006661166660000006666111760761117707711199099111880881100000000000000000000000000000000
16666655566666111666600000006661666000000000666166600000006666111760761117707711199099111880881100000000000000000000000000000000
66000666660006616655660000000661660000000000066166000000066556611760761117707711199099111880881100000000000000000000000000000000
66000066600006616555566000000001660000000000066100000000665575611760761117707711199099111880881100000000000000000000000000000000
66000000000006616555566000000001660000000000066100000000665555611760761117707711199099111880881100000000000000000000000000000000
66000000000006616575566000000001660000666000066100000000665555611760761117707711199099111880881100000000000000000000000000000000
66000000000006616655660000000661660006666600066166000000066556611760761117707711199099111880881100000000000000000000000000000000
66600000000066611666600000006661166666555666661166600000006666111760761117707711199099111880881100000000000000000000000000000000
16660000000666111666600000066661166665555566661166660000006666111760761117707711199099111880881100000000000000000000000000000000
16666000006666111166600000666611116665557566611116666000006661111766661117777711199999111888881100000000000000000000000000000000
11666600066661111116666666666111111666555666111111666666666611111766661117777711199999111888881100000000000000000000000000000000
11166600066611111111166666611111111116666611111111116666661111111176611111777111119991111188811100000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111111117111111171111111911111118111100000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000111bb111111bb11111111111111bb11100000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000001bbbbb1111bbbb111bbbb1111bbbbb1100000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000bb0b0b111b0b0b11bb0b0b11bb0b0b1100000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000bbbbbbb11bbbbbb1bbbbbbb1bbbbbb1100000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000001b000bb11b000bb11b000bb11b000b1100000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000011bbbb111b000b111bbbbb111b00011100000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000111111111bbbb11111bb11111bbbb11100000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000001111111111bb11111111111111bb111100000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000011111bbbbb11111111111bbbbb11111111111bbbbb11111111111bbbbb111111
0000000000000000000000000000000000000000000000000000000000000000111bb00000bb1111111bb00000bb1111111bbbbbbbbb1111111bbbbbbbbb1111
000000000000000000000000000000000000000000000000000000000000000011b000000000b11111b000000000b11111bbbbbbbbbbb11111bbbbbbbbbbb111
00000000000000000000000000000000000000000000000000000000000000001b00000000000b111b00000000000b111bbbbbbbbbbbbb111bbbbbbbbbbbbb11
00000000000000000000000000000000000000000000000000000000000000001b00000000000b111b08000000080b111bbbbbbbbbbbbb111bbbbbbbbbbbbb11
0000000000000000000000000000000000000000000000000000000000000000b0080000000800b1b0088000008800b1bbbbbbbbbbbbbbb1bbbbbbbbbbbbbbb1
0000000000000000000000000000000000000000000000000000000000000000b0088000008800b1b0080800080800b1bbbbbbbbbbbbbbb1bbbbbbbbbbbbbbb1
0000000000000000000000000000000000000000000000000000000000000000b0080800080800b1b0000000000000b1bbbbbbbbbbbbbbb1bbbbbbbbbbbbbbb1
0000000000000000000000000000000000000000000000000000000000000000b0000000000000b1b00bbbbbbbbb00b1bbbbbbbbbbbbbbb1bbbbbbbbbbbbbbb1
0000000000000000000000000000000000000000000000000000000000000000b0000000000000b1b000b0b0b0b000b1bbbbbbbbbbbbbbb1bbbbbbbbbbbbbbb1
0000000000000000000000000000000000000000000000000000000000000000b00bbbbbbbbb00b1b0000000000000b1bbbbbbbbbbbbbbb1bbbbbbbbbbbbbbb1
00000000000000000000000000000000000000000000000000000000000000001b00bb00bbb00b111b00000000000b111bbbbbbbbbbbbb111bbbbbbbbbbbbb11
00000000000000000000000000000000000000000000000000000000000000001b00b0000b000b111b000b0b0b000b111bbbbbbbbbbbbb111bbbbbbbbbbbbb11
000000000000000000000000000000000000000000000000000000000000000011b0b0000b00b11111b0bbbbbbb0b11111bbbbbbbbbbb11111bbbbbbbbbbb111
0000000000000000000000000000000000000000000000000000000000000000111000000b0011111110bb000b001111111bbbbbbbbb1111111bbbbbbbbb1111
00000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111
__map__
0102020301212222222222222302020301020203010202030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1112121311212222222222222312121311121213111212130000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0203010202212222222222222303010202030102020301020203000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1213111212212222222222222313111212131112121311121213000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102020301212222222222222302020301020203010202030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1112121311212222222222222312121311121213111212130000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0203010202212222222222222303010202030102020301020203000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1213111212212222222222222313111212131112121311121213000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102020301212222222222222302020301020203010202030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1112121311212222222222222312121311121213111212130000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0203010202212222222222222303010202030102020301020203000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1213111212212222222222222313111212131112121311121213000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102020301212222222222222302020301020203010202030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1112121311212222222222222312121311121213111212130000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0203010202212222222222222303010202030102020301020203000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1213111212212222222222222313111212131112121311121213000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102020301212222222222222302020301020203010202030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1112121311212222222222222312121311121213111212130000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0203010202212222222222222303010202030102020301020203000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1213111212212222222222222313111212131112121311121213000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
