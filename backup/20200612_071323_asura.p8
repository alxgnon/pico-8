pico-8 cartridge // http://www.pico-8.com
version 27
__lua__
-- asura
--
-- init
function _init()
	actors={}
	pl=_deva(0,0)
	add(actors,pl)
end

-- update
function _update()
	for a in all(actors) do
		if a==pl then
			a:input()
		end
		a:update()
	end
end

-- draw
function _draw()
	cls(13)
	draw_sky()
	for a in all(actors) do
		a:draw()
	end
end

-- draw sky
function draw_sky()
	camera(0,0)
	local camx,camy=pl:camera()
	local sky=min(21-camy,128)
	local hoz=min(200-camy,127)
	rectfill(0,0,128,sky,0)
	if hoz<127 then
		rectfill(0,hoz,128,128,4)
		line(0,hoz,128,hoz,11)
	end
	camera(camx,camy)
	map(0,0,-64,136,128,8)
end
-->8
-- deva
function _deva(x,y)
	return{
		x=x,
		y=y,
		dx=0,
		dy=0,
		flap=0,
		fly=true,
		-- deva:input
		input=function(a)
			if(btn(0))a.dx=-3
			if(btn(1))a.dx=3
			if btn(4) and a.flap<=0 then
				a.flap=1
				a.dy=-14
			elseif not btn(4) and a.dy>=-3 then
				a.flap-=1
			end
		end,
		-- deva:update
		update=function(a)
			a.x+=a.dx
			a.y+=a.dy
			a.dy=a.dy+abs(a.y*0.01)
			a.dx*=0.777
			a.dy*=0.777
			a.y=max(a.y,16)
			a.y=min(a.y,192)
		end,
		-- deva:camera
		camera=function(a)
			return a.x-60,min(a.y-8,100)
		end,
		-- deva:draw
		draw=function(a)
			local f=max(a.flap,-2)
			local x,y=a.x,a.y
			local fx,fy=a.dx/2,a.dy/2
			if a.y<160 then
				rect(x+2,y-4,x+5,y-2,10)
				if	a.flap>-5 then
					spr(max(2+f,0),x-8,y-fx-fy,1,1,1)
					spr(max(2+f,0),x+8,y+fx-fy)
				end
			end
			if fx<1 and fx>-1 then
				spr(4,x,y)
			elseif fx>1 then
				spr(5,x,y,1,1,true)
			else
				spr(5,x,y)
			end
		end
	}
end
__gfx__
0000000000000000000000000000000000ffff000ffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000
060060007777770077777770aaaa000000ffff000ffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000
006600007777777077777777aaaaa00077ffff777ffff77000000000000000000000000000000000000000000000000000000000000000000000000000000000
0066000007777700077777770aaaaa007777f777777f777000000000000000000000000000000000000000000000000000000000000000000000000000000000
06006000007700000077077700aaaa00777767777776777000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000077000aaa00077767700776770000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000aaaa0006666000666600000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000aaa000aaaa000aaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b00000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b4b0000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b444b000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b04440b00000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004b40000000
0066660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b4b0000000
066666600044440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b444b000000
06666660004444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b04440b00000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b004b400b0000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b4b0000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b444b000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b04440b00000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b004b400b0000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b000b4b000b000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b444b000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b04440b00000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b004b400b0000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b000b4b000b000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b000b444b000b00
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b04440b00000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b004b400b0000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b000b4b000b000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b000b444b000b00
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b000b04440b000b0
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004440000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004440000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004440000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004440000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004440000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004440000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004440000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004440000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004e4f0000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004e4f00000000005e5f0000
000000004e4f004e4f00004e4f00000000004e4f004e4f00004e4f00004e4f004e4f000000004e4f004e4f00004e4f004e4f00004e4f004e4f004e4f000000004e4f0000004e4f00000000004e4f00004e4f0000004e4f004e4f4e4f00004e4f0000004e4f4e4f00004e4f00004e4f00004e4f00005e5f00004e4f006e6f0000
000000005e5f005e5f00005e5f00000000005e5f005e5f00005e5f00005e5f005e5f000000005e5f005e5f00005e5f005e5f00005e5f005e5f005e5f000000005e5f0000005e5f00000000005e5f00005e5f0000005e5f005e5f5e5f00005e5f0000005e5f5e5f00005e5f00005e5f00005e5f00006e6f00005e5f006e6f0000
000000006e6f006e6f00006e6f00000000006e6f006e6f00006e6f00006e6f006e6f000000006e6f006e6f00006e6f006e6f00006e6f006e6f006e6f000000006e6f0000006e6f00000000006e6f00006e6f0000006e6f006e6f6e6f00006e6f0000006e6f6e6f00006e6f00006e6f00006e6f00006e6f00006e6f007e7f0000
004100007e7f007e7f00007e7f40000041007e7f007e7f00407e7f41007e7f007e7f400000007e7f007e7f00417e7f007e7f00407e7f007e7f007e7f004000007e7f0040007e7f00004100007e7f00407e7f0000007e7f417e7f7e7f00007e7f0000407e7f7e7f00417e7f40007e7f00007e7f41007e7f40007e7f417e7f4000
