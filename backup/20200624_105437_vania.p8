pico-8 cartridge // http://www.pico-8.com
version 27
__lua__
-- vania
--

-- setup
function setup()
	actors={}
	palt(0,false)
	palt(1,true)
end


-- init
function _init()
	setup()
	world=make(root,0,0,128,64)
	make(player,48,48,1,1)
end


-- update
function _update()
	for a in all(actors) do
		a.update(a)
		a.t+=1
	end
end


-- draw
function _draw()
	cls()
	for a in all(actors) do
		a.draw(a)
	end
end
-->8
-- entity
--

root=0
player=80

update={}
draw={}


-- make
function make(f,x,y,w,h)
	local a={f=f,x=x,y=y,w=w,h=h,dx=0,dy=0,t=0}
	a.update=update[f]
	a.draw=draw[f]
	add(actors,a)
	return a
end


-- update_root
update[root]=function(a)
end


-- draw_root
draw[root]=function(a)
	camera(a.x,a.y)
	map(0,0,0,0,128,64)
end


-- update_player
update[player]=function(a)
	control(a)
	move(a)
	fall(a)
	physics(a)
	follow(a.x,a.y)
end


-- draw_player
draw[player]=function(a)
	local f=anim_walk(a)
	sprite(f,a.x,a.y,1,1,a.z)
end
-->8
-- component
--

-- follow
function follow(x,y)
	local camx,camy=0,0
	if x<384 then
		camx=min(max(x-64,0),256)
		camy=min(max(y-72,0),128)
	end
	world.x,world.y=camx,camy
end


-- control
function control(a)
	if btn(0) and btn(1) then
		a.dx=0
	elseif btn(0) then
		a.dx=-3
		a.z=true
	elseif btn(1) then
		a.dx=3
		a.z=false
	end
end


-- move
function move(a)
	if(abs(a.dx)<1)return
	for i=1,abs(a.dx) do
		a.x+=sgn(a.dx)
		for j=0,7,7 do
			local t=mget((a.x+j)/8,a.y/8)
			if fget(t,1) then
				a.x-=sgn(a.dx)
				a.dx=0
				break
			end
		end
	end
end


-- fall
function fall(a)
	for i=1,abs(a.dy) do
		a.y+=sgn(a.dy)
		for j=0,7,7 do
			t=mget((a.x+j)/8,a.y/8)
			if fget(t,1) then
				a.y-=sgn(a.dy)
				a.land=true
				break
			end
		end
	end
end


-- physics
function physics(a)
	if(a.dx!=0)a.dx-=sgn(a.dx)
	if(abs(a.dx)<1)a.dx=0
	a.dy=min(a.dy+1,8)
end
-->8
-- draw
--

-- anim_walk
function anim_walk(a)
	local f=a.f
	if a.land and abs(a.dx)>1 then
		f=a.f+(a.t/4)%4
	elseif a.land then
		f=a.f+(a.t/18)%2
	end
	return f
end


-- sprite
function sprite(f,x,y,w,h,z)
	spr(f,x,y-h*8,w,h,z)
end
__gfx__
11111111660066661111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111666066661111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11711711666006661111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11177111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11177111066666601111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11711711666666601111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111666666001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111000000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
15555511111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
15555511111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
15555511111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
15555511111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
15555511188881111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
10099011888777111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
55555551888888881111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
77777771111111117777777111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
70000001777777717000000177777771111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
70c00c017000000170c00c0170000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
7000000170c00c017000000170c00c01111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
99999991700000019999999170000001111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
14444411999999911444441199999991111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
19111911144444111911119114444411111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
14111411191119111411114191111911111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010100000000000000000000000001010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010100000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010100000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010100000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010100000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010100000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010100000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010100000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010100000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010100000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010100000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010100000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010100000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010100000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010100000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010100000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010100000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010100000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010100000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010100000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010100000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010100000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010100000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010100000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010100000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010100000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010100000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010100000000000000000000000001010
10100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010100000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010100000000000000000000000001010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
__gff__
0002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010000000000000000000000000101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000101
