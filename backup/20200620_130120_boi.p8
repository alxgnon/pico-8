pico-8 cartridge // http://www.pico-8.com
version 27
__lua__
-- boi
--
function _init()
	palt(0,false)
	gt=0
	state=-1
	for i=0,127 do
		if(rnd(100)>78)mset(i,0,65)
	end
	start()
	spawn(8)
	camx=-1
	camdx=0
end

function start()
	pt=0
	px=31
	py=100
	pz=0
	head=2
	chest=18
	arms=19
	weapon=20
	legs=34
	boots=50
	still=true
end

function spawn(h)
	et=0
	ex=px+176
	ey=100
	ez=0
	ehead=h
	if h==8 then
		echest=24
		earms=25
		eweapon=26
		elegs=40
		eboots=56
	else
		echest=30
		earms=31
		eweapon=20
		elegs=46
		eboots=62
	end
end

function _update()
	gt+=1
	walk()
	follow()
end

function walk()
	if state==-1 and gt>2 then
		if not (btn(4) or btn(5)) then
			state=0
		end
	elseif state==0 then
		if btn(4) or btn(5) then
			state=1
		end
	elseif state==1 or state==2 then
		px+=5
		pt=(pt+1)%12
		if px>ex-56 then
			state=3
			px=ex-56
			pt=0
		end
	end
end

function follow()
	if state==1 then
		if px>ex-184 then
			camdx=8
			state=2
		end
	elseif state==2 or state==3 then
		camx=camx+flr(camdx)
		camdx=max(camdx*0.965,0)
		if camx>ex-88 then
			camx=ex-88
			if state==2 then
			 state=4
			end
		end
	end
end

function _draw()
	cls()
	camera(camx,0)
	spr(1,px-8,40+(gt%80/40))
	spr(1,px,40+((gt+3)%80/40))
	spr(1,px+8,40+((gt+6)%80/40))
	dchars()
	dground()
end

function dchars()
	local y=py-7+abs(pt%11-6)
	dlegs(y)
	y-=flr(gt%128/64-1)
	dbody(y)
	darms(y)
	y=ey-1
	delegs(y)
	y-=flr((gt+12)%128/64-1)
	debody(y)
	dearms(y)
end

function dground()
	map(0,0,0,100,128,1)
	camera(0,0)
	rectfill(0,108,128,128,5)
end

function dbody(y)
	spr(head,px,y-28)
	spr(chest,px,y-20)
end

function dlegs(y)
	if pt%12>1 and pt%12<9 then
		spr(legs+1,px,y-12)
		spr(boots+1,px-8,y-12,1,1,true,true)
		spr(boots+1,px+8,y-12)
	else
		spr(legs,px,y-12)
		spr(boots,px,y-4)
	end
end

function darms(y)
	spr(arms-2,px-8,y-20)
	if pz==1 then
		spr(arms-3,px+8,y-25,1,1,true,true)
		spr(weapon+16,px+9,y-41,1,2,false,true)
	elseif pz==3 then
		spr(arms-2,px+8,y-20,1,1,true)
		spr(weapon+16,px+8,y-11,1,2)
	else
		spr(arms,px+8,y-20)
		spr(weapon,px+16,y-20,2,1)
	end
end

function debody(y)
	spr(ehead,ex,y-28,1,1,true)
	spr(echest,ex,y-20,1,1,true)
end

function delegs(y)
	spr(elegs,ex,y-12,1,1,true)
	spr(eboots,ex,y-4,1,1,true)
end

function dearms(y)
	spr(earms-2,ex+8,y-20,1,1,true)
	if ez==1 then
		spr(earms-3,ex-8,y-25,1,1,false,true)
		spr(eweapon+16,ex-9,y-41,1,2,true,true)
	elseif ez==3 then
		spr(earms-2,ex-8,y-20)
		spr(eweapon+16,ex-8,y-11,1,2,true)
	else
		spr(earms,ex-8,y-20,1,1,true)
		spr(eweapon,ex-24,y-20,2,1,true)
	end
end
__gfx__
00000000000000000444444400000000000000000000000000000000000000000999999900000000000000000000000000000000000000000666666600000000
00000000880008804400400400000000000000000000000000000000000000009900900900000000000000000000000000000000000000006600600600000000
00700700888088804400400400000000000000000000000000000000000000009900900900000000000000000000000000000000000000006600600600000000
00077000888888804444444400000000000000000000000000000000000000009999999900000000000000000000000000000000000000006666666600000000
00077000888888804444444400000000000000000000000000000000000000009000000900000000000000000000000000000000000000006666666600000000
00700700088888004090909000000000000000000000000000000000000000009000000900000000000000000000000000000000000000006060606000000000
00000000008880000409090900000000000000000000000000000000000000009099990900000000000000000000000000000000000000000606060600000000
00000000000800000044444400000000000000000000000000000000000000009990099900000000000000000000000000000000000000000066666600000000
00000444000000000000000000000000600000000000000000000444000000000000000000000000900000000000000000000066000000000000000000000000
00004444000000444400004444400000644444444444444000004444000000446600006644400000966666666666666000006660000006066600006666000660
00004444000004444440044444444440600000000000004400004444000004446660066644444640900000000000000600006066000006666660066606666600
00004400000004444444444444444440644444444444444000004400000004446666666644444640966666666666666000006000000000600666666066000660
00004400000004440424424000000000600000000000000000004400000004440666666000000000900000000000000000006000000000600006600000000000
00004400000000440444444000000000000000000000000000006600000000440666666000000000000000000000000000066600000000600666666000000000
00004400000000440444444000000000000000000000000000004400000000660666666000000000000000000000000000060600000006660006600000000000
00000000000000440444444000000000000000000000000000000000000000440666666000000000000000000000000000000000000006060666666000000000
00000000000000000000000000000000666660000000000000000000000000000000000000000000999990000000000000000000000000000000000000000000
00000000000000000444444004444440040400000000000000000000000000000444994004449940060600000000000000000000000000000222aa200222aa20
00000000000000000666666006666660040400000000000000000000000000000cccccc00cccccc0060600000000000000000000000000000888888008888880
00000000000000000666666066666666040400000000000000000000000000000cccccc0cccccccc060600000000000000000000000000000888888088888888
00000000000000000666066066666666040400000000000000000000000000000ccc0cc0cccccccc060600000000000000000000000000000888088088888888
00000000000000000666066000000000040400000000000000000000000000000ccc0cc000000000060600000000000000000000000000000888088000000000
00000000000000000666066000000000040400000000000000000000000000000ccc0cc000000000060600000000000000000000000000000888088000000000
00000000000000000660066000000000040400000000000000000000000000000cc00cc000000000060600000000000000000000000000000880088000000000
00000000000000000440044000000000040400000000000000000000000000000660066000000000060600000000000000000000000000000600006000000000
00000000000000000440044000440000040400000000000000000000000000000660066000660000060600000000000000000000000000000600006000660000
00000000000000000444044444440000040400000000000000000000000000000666066666660000060600000000000000000000000000006660066666600000
00000000000000000444044444440000040400000000000000000000000000000666066666660000060600000000000000000000000000006060060600660000
00000000000000000000000000000000040400000000000000000000000000000000000000000000060600000000000000000000000000000000000000000000
00000000000000000000000000000000040400000000000000000000000000000000000000000000060600000000000000000000000000000000000000000000
00000000000000000000000000000000040400000000000000000000000000000000000000000000060600000000000000000000000000000000000000000000
00000000000000000000000000000000004000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000
66666660665666500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666660665665500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666660665655600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666660666566600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666660655566600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666660566556600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555550555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
4040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040
