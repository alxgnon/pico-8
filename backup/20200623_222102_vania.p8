pico-8 cartridge // http://www.pico-8.com
version 27
__lua__
-- vania
--
function _init()
	palt(0,false)
	palt(1,true)
	world.make()
end

function _update()
	pl.update()
	world.update()
end

function _draw()
	cls()
	cam.draw()
	world.draw()
	pl.draw()
end

-- world
world={
	make=function()
		room={}
		for i=1,32 do
			room[i]={}
		end
		_b(1,5)
		world.load(1,6)
	end,
	update=function()
	end,
	load=function(x,y)
		x,y=flr(x),flr(y)
		if room[x] and room[x][y] then
			r=room[x][y]
			if(r.l)r.l()
		end
	end,
	draw=function()
		map(r.j,r.i,r.x*128,r.y*128,r.w,r.h)
	end
}

-- room layouts
function _r(x,y,j,i,w,h,l)
	return{j=j,i=i,x=x,y=y,w=w,h=h,l}
end

function _b(x,y,l)
	local r=_r(x,y,0,0,48,32,l)
	room[x][y]=r
	room[x][y+1]=r
	room[x][y+2]=r
	room[x+1][y]=r
	room[x+1][y+1]=r
	room[x+1][y+2]=r
end
-->8
-- player
--
pl={
	x=182,
	y=849,
	f=0,
	t=-1,
	update=function()
		anim_facing()
		if pl.halt then
			pl.t=-1
		else
			local dx=arrows(2.625)
			if dx!=0 then
				pl.t+=1
				pl.x+=dx
			else
				pl.t=-1
			end
		end
	end,
	draw=function()
		local x,y=pl.x,pl.y
		local f,t=pl.f,pl.t
		local h=flr(pl.t/16)%2
		if t>-1 then
			t=flr(cos(pl.t/2)*2)_
		else
			t=0
		end
		if f<5 and f>-4 then
			spr(128,x,y+h,1,2)
			spr(160,x-3,y+16,2,2)
			spr(130,x+8,y+8+h,1,2)
			spr(130,x-1,y+8+h)
		elseif f>0 then
			spr(129,x,y+h,1,2)
			spr(160+t,x-3,y+16,2,2)
			spr(130,x+8,y+8+h,1,2)
			spr(130,x-1,y+8+h)
		else
			spr(129,x,y+h,1,2,true)
			spr(160+t,x-5,y+16,2,2,true)
			spr(130,x+1,y+8+h,1,2,true)
			spr(130,x-1,y+8+h)
		end
		if f<2 then
			spr(131,x-16,y+16+h,2,1,true)
		else
			spr(131,x-1,y+16+h,2,1)
		end
	end
}

-- input
function arrows(mult)
	local dx=0
	if(btn"0")dx-=mult
	if(btn"1")dx+=mult
	return dx
end

-- animation
function anim_facing()
	pl.halt=btn"0" and btn"1"
	if pl.halt then
		pl.f=0
	else
		if btn"0" then
			pl.f=max(pl.f-1,-8)
		elseif btn"1" then
			pl.f=min(pl.f+1,8)
		end
	end
end

-- camera
cam={
	x=128,
	y=768,
	update=function()
	end,
	draw=function()
		camera(cam.x,cam.y)
	end
}


__gfx__
11111111665566661111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111666566661111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11711711666556661111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11177111555555551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11177111566666651111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11711711666666651111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111666666551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111555555551111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
116666111166661111111111ff0c1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
166656611666656191111111ff0c6666666666611111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
6665f56666665f5651111111ff0c6666666666611111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
555fff555555fff551111111111c1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
ff28f28ffff28f285111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
ffffffffffffffff5111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1ffffff11ffffff19111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11ffff1111ffff115111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
9900009999900009ff11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
5590095555590095ff11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
5599995555599995ff11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
55955955555955951111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
15955951155955911111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
15955951155955911111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
15955951155955911111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
15555551155555511111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11110006601111111111000660111111111100066011111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11119999991111111111999999111111111199999911111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11115555551111111111555555111111111155555511111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11115555551111111111555555511111111155555551111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11115550551111111111555055591111111155505559111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11115550551111111115555111991111111555511199511111111111111111111111111111111111111111111111111111111111111111111111111111111111
11115590591111111115595115551111111559111155511111111111111111111111111111111111111111111111111111111111111111111111111111111111
11115990991111111115991115551111115599111115551111111111111111111111111111111111111111111111111111111111111111111111111111111111
11115550551111111115511111599111155511111115991411111111111111111111111111111111111111111111111111111111111111111111111111111111
11115550551111111115511111441111159911111115444411111111111111111111111111111111111111111111111111111111111111111111111111111111
11119990991111111159911114441111144111111115444411111111111111111111111111111111111111111111111111111111111111111111111111111111
11114440441111111144111114441111444111111111144111111111111111111111111111111111111111111111111111111111111111111111111111111111
11114440441111111444111111444111444111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11114440441111111444111111111111144411111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11114444444111111144411111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111113311111331311111113111112221111133111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111138831113883831111137311124442111388311
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111380873113288831111377731124421111366311
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111388873113828231113773311124421113633631
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111137731113822831137731111128211113633631
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111113311113828311377311111128111111366311
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111113333111137311111112111111133111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111113111111111111111111111
__map__
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010000000000000101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010000000000000101010101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010000000000000000000000000101
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010000000000000000000000000101
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010000000000000000000000000101
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010000000000000000000000000101
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010000000000000000000000000101
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010000000000000000000000000101
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101010000000000000000000000010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101010000000000000000000000010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101010000000000000000000000010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101010000000000000000000000010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010000000000000000000000000101
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101010000000000000000000000010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010000000000000000000000000101
0101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101010000000000000000000000010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010000000000000000000000000101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010100000000000001010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010100000000000001010101010101010101010101010101010101010101010101010101010101010101010101
